---
label: AWS
title: AWS RDB에 대한 깊은 고찰
subTitle: Redis
date: 2024.10.01
mins: 20
tags: [AWS, RDS, MYSQL]
imageUrl: /posts/post/redis-foam/redis_foam_title.png
---

## RDS의 접근과 비용 그리고 서버

### AWS RDS for MySQL (서울 기준)

| 특성             | gp2                               | gp3                                  | gp3 (스트라이프 볼륨)                 | io2 Block Express                   |
|------------------|-----------------------------------|--------------------------------------|--------------------------------------|-------------------------------------|
| **용도**         | 범용 SSD                          | 범용 SSD                              | 범용 SSD 스트라이핑                   | 고성능 IOPS SSD                      |
| **비용**         | 월 $ 0.114/GiB                    | 월 $ 0.0912/GiB                       | 월 $ 0.0912/GiB                      | 월 $ 0.1278/GiB                     |
| **볼륨크기**     | 1GiB - 16TiB                      | 1GiB - 399GiB                         | 400GiB - 16TiB                       | 4GiB - 16TiB <br/>4GiB - 64TiB (Nitro)         |
| **I/O 성능**     | 3 IOPS/GB 무료<br/>최대 16,000 IOPS | 3,000 IOPS 무료<br/>최대 16,000 IOPS | 12,000 IOPS 무료<br/>최대 64,000 IOPS | 최대 64,000 IOPS <br/> 최대 256,000 IOPS (Nitro)   |
| **I/O 비용**     | 무료                              | 월 $ 0.0057/IOPS                      | 월 $ 0.0057/IOPS                      | 월 $ 0.067/IOPS(-32,000) <br/> 월 $ 0.047/IOPS(-64,000) <br/> 월 $ 0.033/IOPS(64,001-) |
| **I/O 비율**     | 수동 프로비저닝 불가               | GiB당 최대 500 IOPS                   | GiB당 최대 500 IOPS                   | GiB당 최대 1,000 IOPS                            |
| **스루풋**       | 128 MiB/s <br/>- 250 MiB/s        | 125MiB/s <br/>- 1,000 MiB/s          | 500MiB/s <br/>- 4,000 MiB/s           | 1,000MiB/s <br/>- 4,000 MiB/s                    |
| **스루풋 비용**  | 없음                              | 125MiB/s 무료<br/> 월 $ 0.046/MiB/s | 500MiB/s 무료<br/> 월 $ 0.046/MiB/s     | 없음                                                                 |
| **스루풋 속도**  | - 170GiB <br/> (최대 128MiB/s)<br/> - 334GiB <br/> (최대 250MiB/s 버스트) | 최대 0.25MiB/s | 최대 0.25MiB/s        | 최대 0.256MiB/s                                                      |
| **인스턴스**     | EC2 <br/> (최대 260,000 IOPS)     | EC2 <br/> (최대 260,000 IOPS)         | EC2 <br/> (최대 260,000 IOPS)         | Nitro EC2 <br/> (256,000 IOPS) <br/> EC2 <br/> (최대 420,000 IOPS)   |
| **처리량**       | EC2 <br/> (최대 7,500MiB/s)       | EC2 <br/> (최대 12,500MiB/s)           | EC2 <br/> (최대 12,500MiB/s)         | EC2 <br/> (최대 12,500MiB/s)                                         |
| **평균지연시간** | 한자리 밀리초                     | 한자리 밀리초                          | 한자리 밀리초                         | 밀리초 미만                          |
| **내구성**       | 99.8-99.9%                        | 99.8-99.9%                            | 99.8-99.9%                           | 99.999% (더 높은 내구성)             |

### gp2

- 비용, 기능적으로 gp2를 gp3대신 택해서 사용할 이유가 없다.

### gp3

| Option | DB        | DB 비용       | IOPS    | IOPS 비용  | 쓰루풋                             | 쓰루풋 비용 | 총 비용         |
|--------|-----------|---------------|---------|------------|-----------------------------------|-------------|----------------|
| Opt1   | 6GiB ~    | 월 $ 0.5472 ~ | 3,000   | 없음       | 평균 42.67KiB/s (125MiB/s 기준)    | 없음        | 월 $ 0.5472 ~  |
| Opt2   | 400GiB ~  | 월 $ 36.48 ~  | 12,000  | 없음       | 평균 42.67KiB/s (500MiB/s 기준)    | 없음        | 월 $ 36.48 ~   |


### gp3 + Redis

| DB 크기 | Request/s | REDIS 비사용                    | REDIS (60%)                  | REDIS (90%)                 |
|---------|-----------|--------------------------------|------------------------------|-----------------------------|
| 100GiB  | 5,000     | 월 $ 11.4<br/>(2,000 IOPS)     | 없음                         | 없음                         |
| 100GiB  | 10,000    | 월 $ 39.9<br/>(7,000 IOPS)     | 월 $ 5.7<br/>(1,000 IOPS)    | 없음                         |
| 400GiB  | 20,000    | 월 $ 45.6<br/>(8,000 IOPS)     | 없음                         | 없음                         |
| 400GiB  | 40,000    | 월 $ 159.6<br/>(28,000 IOPS)   | 월 $ 22.8<br/>(4,000 IOPS)   | 없음                         |


### DB 설계 전략

- Redis를 통해 60% - 90% 캐싱
- EventBridgeScheduler(db_auto_buffer_scheduler)를 통해 5분마다 Lambda 실행
- CloudWatch를 통해 이전 5분 평균 IOPS와 Throughput을 측정
- 이전 5분 이용량의 평균에서 15%의 추가 IOPS 버퍼 
- 이전 5분 이용량의 평균에서 15%의 추가 Throughput 버퍼 

### RDS 인스턴스의 IOPS 감당
| 인스턴스 클래스    | 메모리 (GiB) | 최대 IOPS  | 월 비용 (USD)   |
|-------------------|--------------|------------|-----------------|
| `db.t3.micro`     | 1            | 최대 1,000 | 약 15.00        | 
| `db.t3.small`     | 2            | 최대 2,000 | 약 30.00        |
| `db.t3.medium`    | 4            | 최대 3,000 | 약 60.00        |
| `db.t3.large`     | 8            | 최대 6,000 | 약 120.00       |
| `db.t3.xlarge`    | 16           | 최대 12,000| 약 240.00       |
| `db.t3.2xlarge`   | 32           | 최대 24,000| 약 480.00       |
| `db.m5.large`     | 8            | 최대 16,000| 약 120.00       |
| `db.m5.xlarge`    | 16           | 최대 32,000| 약 240.00       |
| `db.m5.2xlarge`   | 32           | 최대 64,000| 약 480.00       |
| `db.m5.4xlarge`   | 64           | 최대 128,000| 약 960.00      |
| `db.m5.12xlarge`  | 192          | 최대 240,000| 약 1,920.00    |
| `db.m5.24xlarge`  | 384          | 최대 480,000| 약 3,840.00    |