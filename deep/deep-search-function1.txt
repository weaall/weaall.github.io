3:I[5613,[],""]
5:I[1778,[],""]
6:I[7709,["229","static/chunks/229-9d8f69c46fe74846.js","396","static/chunks/396-67972dd1b50a4c2d.js","185","static/chunks/app/layout-adc08d2f888497b9.js"],""]
7:I[8667,["160","static/chunks/app/not-found-50c5c2993e985d24.js"],""]
4:["slug","deep-search-function1","d"]
0:["TNUQmFhMAb6IjW9LXNZ3l",[[["",{"children":["(pages)",{"children":["deep",{"children":[["slug","deep-search-function1","d"],{"children":["__PAGE__?{\"slug\":\"deep-search-function1\"}",{}]}]}]}]},"$undefined","$undefined",true],["",{"children":["(pages)",{"children":["deep",{"children":[["slug","deep-search-function1","d"],{"children":["__PAGE__",{},["$L1","$L2",null]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","(pages)","children","deep","children","$4","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","(pages)","children","deep","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","(pages)","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]},[null,["$","html",null,{"lang":"kr","children":[["$","head",null,{"children":[["$","meta",null,{"name":"naver-site-verification","content":"e782934088f4524e1d46947402328d9864f04318"}],["$","meta",null,{"name":"google-site-verification","content":"EB5qLPhkvA7mD6Yz6VpiZaMErWP4KIB7Aj_rR-xqdsA"}],["$","link",null,{"rel":"icon","href":"/favicon.ico"}]]}],["$","body",null,{"className":"__className_a1b02f","children":["$","div",null,{"children":[["$","div",null,{"children":[["$","$L6",null,{}],["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","$L7",null,{}],"notFoundStyles":[],"styles":null}]],"style":{},"className":"mx-auto max-w-[1080px] h-auto px-1"}],["$","div",null,{"children":["$","div",null,{"children":[["$","div",null,{"children":[["$","p",null,{"children":"Dong-Hyun Wi","style":{},"className":"font-bold text-2xl"}],["$","p",null,{"children":"weaall@naver.com","style":{},"className":"text-sm"}],["$","p",null,{"children":"weaall88@gmail.com","style":{},"className":"text-sm"}]],"style":{},"className":"flex flex-col m-auto text-center space-y-1 w-[33%]"}],["$","div",null,{"children":["$","img",null,{"alt":"","src":"../../assets/svg/user_icon.svg","style":{},"className":"w-8 h-full m-auto group-hover:scale-110"}],"style":{},"className":"flex flex-col m-auto text-center space-y-1 w-[33%]"}],["$","div",null,{"children":[["$","a",null,{"href":"/","children":"Main","style":{},"className":"font-bold text-base"}],["$","a",null,{"href":"/shallow","children":"Shallow","style":{},"className":"font-bold text-base"}],["$","a",null,{"href":"/deep","children":"Deep","style":{},"className":"font-bold text-base"}],["$","a",null,{"href":"/me","children":"Me","style":{},"className":"font-bold text-base"}]],"style":{},"className":"flex m-auto space-x-4 w-[33%] justify-center"}]],"style":{},"className":"mx-auto max-w-[1080px] h-40 justify-between flex mobile:flex-col mobile:h-52"}],"style":{},"className":"w-full border-t mt-20 text-text-main"}]],"style":{},"className":"mx-auto text-main max-w-[1080px]"}]}]]}],null]],[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/6a5f3c35560f6327.css","precedence":"next","crossOrigin":""}],["$","link","1",{"rel":"stylesheet","href":"/_next/static/css/5c6c6eeee5df922a.css","precedence":"next","crossOrigin":""}]],"$L8"]]]]
9:I[9275,["229","static/chunks/229-9d8f69c46fe74846.js","624","static/chunks/624-a506dc0205ec4c32.js","606","static/chunks/app/(pages)/deep/%5Bslug%5D/page-0f8f53d5c22a66de.js"],"MDXContent"]
a:I[2946,["229","static/chunks/229-9d8f69c46fe74846.js","624","static/chunks/624-a506dc0205ec4c32.js","606","static/chunks/app/(pages)/deep/%5Bslug%5D/page-0f8f53d5c22a66de.js"],"H2"]
b:I[2946,["229","static/chunks/229-9d8f69c46fe74846.js","624","static/chunks/624-a506dc0205ec4c32.js","606","static/chunks/app/(pages)/deep/%5Bslug%5D/page-0f8f53d5c22a66de.js"],"Li"]
c:I[2946,["229","static/chunks/229-9d8f69c46fe74846.js","624","static/chunks/624-a506dc0205ec4c32.js","606","static/chunks/app/(pages)/deep/%5Bslug%5D/page-0f8f53d5c22a66de.js"],"A"]
d:I[2946,["229","static/chunks/229-9d8f69c46fe74846.js","624","static/chunks/624-a506dc0205ec4c32.js","606","static/chunks/app/(pages)/deep/%5Bslug%5D/page-0f8f53d5c22a66de.js"],"Hr"]
e:I[2946,["229","static/chunks/229-9d8f69c46fe74846.js","624","static/chunks/624-a506dc0205ec4c32.js","606","static/chunks/app/(pages)/deep/%5Bslug%5D/page-0f8f53d5c22a66de.js"],"Img"]
f:I[2946,["229","static/chunks/229-9d8f69c46fe74846.js","624","static/chunks/624-a506dc0205ec4c32.js","606","static/chunks/app/(pages)/deep/%5Bslug%5D/page-0f8f53d5c22a66de.js"],"Em"]
10:I[2946,["229","static/chunks/229-9d8f69c46fe74846.js","624","static/chunks/624-a506dc0205ec4c32.js","606","static/chunks/app/(pages)/deep/%5Bslug%5D/page-0f8f53d5c22a66de.js"],"Strong"]
11:I[2946,["229","static/chunks/229-9d8f69c46fe74846.js","624","static/chunks/624-a506dc0205ec4c32.js","606","static/chunks/app/(pages)/deep/%5Bslug%5D/page-0f8f53d5c22a66de.js"],"H3"]
12:I[2946,["229","static/chunks/229-9d8f69c46fe74846.js","624","static/chunks/624-a506dc0205ec4c32.js","606","static/chunks/app/(pages)/deep/%5Bslug%5D/page-0f8f53d5c22a66de.js"],"Pre"]
13:I[2946,["229","static/chunks/229-9d8f69c46fe74846.js","624","static/chunks/624-a506dc0205ec4c32.js","606","static/chunks/app/(pages)/deep/%5Bslug%5D/page-0f8f53d5c22a66de.js"],"Code"]
14:T4c6,export async function saveSearchValue(value: string): Promise<void> {
    const now = new Date();
    const key = `popular:${now.toISOString().slice(0, 13)}`;
    await client.zincrby(key, 1, value);

    await client.expire(key, 43200);
}

export async function getSearchRank(): Promise<{ term: string; score: number }[]> {
    const now = new Date();
    const keys: string[] = [];
    const limit = 10;

    for (let i = 0; i < 12; i++) {
        const pastDate = new Date(now.getTime() - i * 3600 * 1000);
        const key = `popular:${pastDate.toISOString().slice(0, 13)}`;
        keys.push(key);
    }

    const allScores: Map<string, number> = new Map();
    for (const key of keys) {
        const results = await client.zrevrange(key, 0, -1, "WITHSCORES");
        for (let i = 0; i < results.length; i += 2) {
            const term = results[i];
            const score = parseInt(results[i + 1]);
            allScores.set(term, (allScores.get(term) || 0) + score);
        }
    }

    const sortedScores = Array.from(allScores.entries())
        .sort((a, b) => b[1] - a[1])
        .slice(0, limit);

    return sortedScores.map(([term, score]) => ({ term, score }));
}
15:T5c6,async getRank(req: Request, res: Response) {
        try {
            const currentKey: string = `/SearchRank`;
            const pastKey: string = `/SearchRank/Past`;
            const tempKey: string = `/SearchRank/Temp`;
    
            const currentRedisData = JSON.parse(await getRedis(currentKey));
            const pastRedisData = JSON.parse(await getRedis(pastKey));
            const temRedisData = JSON.parse(await getRedis(tempKey));
    
            if (redisData === null) {
                const data = await getSearchRank();

                setRedis1H(pastKey,tempRedisData)
                setRedis1H(currentKey, data);
                setRedis2H(tempKey, data);
    
                res.status(200).json({
                    error: null,
                    data: {
                        past: temRedisData || [],
                        current: data || [],
                    }
                });
            } else {
                res.status(200).json({
                    error: null,
                    data: {
                        past: pastRedisData || [],
                        current: currentRedisData || [],
                    }
                });
            }
        } catch (error) {
            res.status(200).json({
                error: null,
                data: {
                    past: [],
                    current: []
                }
            });
        }
    }
2:["$","$L9",null,{"content":[["$","$La",null,{"children":"검색창의 다양화"}],"\n",["$","ul",null,{"children":["\n",["$","$Lb",null,{"children":["I: 실시간 검색어 순위 - ",["$","$Lc",null,{"href":"https://weaall.github.io//deep/deep-search-function1","children":"Link"}]]}],"\n",["$","$Lb",null,{"children":["II: 최근 검색어 - ",["$","$Lc",null,{"href":"https://weaall.github.io//deep/deep-search-function2","children":"Link"}]]}],"\n",["$","$Lb",null,{"children":["III: 검색어 찾기 - ",["$","$Lc",null,{"href":"https://weaall.github.io//deep/deep-search-function3","children":"Link"}]]}],"\n"]}],"\n",["$","$Ld",null,{}],"\n",["$","$La",null,{"children":"실시간 검색어 순위"}],"\n",["$","p",null,{"children":["$","$Le",null,{"src":"/posts/deep/search-function1/map.png","alt":"1","title":"실시간 검색어 순위 구조"}]}],"\n",["$","ul",null,{"children":["\n",["$","$Lb",null,{"children":["백엔드로 검색API요청이 오면 해당 검색어를 레디스 ",["$","$Lf",null,{"children":"saveSearchValue"}],"를 통해 저장"]}],"\n",["$","$Lb",null,{"children":[["$","$Lf",null,{"children":"key"}],"를 통해 매시간마다 다른 키를 생성해서 ",["$","$Lf",null,{"children":"Sorted Set"}],"을 생성 ",["$","$L10",null,{"children":"(expire을 통해 12시간동안 유지)"}]]}],"\n",["$","$Lb",null,{"children":[["$","$Lf",null,{"children":"ZINCRBY"}],"를 통해 해당시간 ",["$","$Lf",null,{"children":"Sorted Set"}],"에 속한 검색어의 조회횟수를 1회씩 증가가"]}],"\n",["$","$Lb",null,{"children":[["$","$Lf",null,{"children":"setSearchRank"}],"를 통해 최근 12시간 동안의 검색어 순위를 조회 ",["$","$L10",null,{"children":"(점수를 합산하여 정렬)"}]]}],"\n",["$","$Lb",null,{"children":["가장 최근 12시간 검색어의 ",["$","$L10",null,{"children":"실시간성"}]," 유지 + ",["$","$L10",null,{"children":"휘발성 데이터 자동관리"}]]}],"\n"]}],"\n",["$","$L11",null,{"children":"./Redis.utils.tsx"}],"\n",["$","$L12",null,{"children":["$","$L13",null,{"className":"language-typescript","children":"$14"}]}],"\n",["$","$L11",null,{"children":"./SearchController.tsx"}],"\n",["$","$L12",null,{"children":["$","$L13",null,{"className":"language-typescript","children":"$15"}]}],"\n",["$","$L11",null,{"children":"./SearchDropDown.tsx"}],"\n",["$","$L12",null,{"children":["$","$L13",null,{"className":"language-typescript","children":"const [currentRankList, setCurrentRankList] = useState([{ term: \"-\", score: 0 }]);\r\nconst [pastRankList, setPastRankList] = useState([{ term: \"-\", score: 0 }]);\r\n\r\nconst fetchSearch = useCallback(async () => {\r\n        setLoading(true);\r\n        try {\r\n            const { data } = await axiosInstance.get(\"/search/rank\");\r\n            setCurrentRankList(data.data.current);\r\n            setPastRankList(data.data.past);\r\n        } catch (error) {\r\n            handleAxiosError(error, navigate);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [navigate]);\r\n\r\nconst getRankStatus = (term: string, index: number) => {\r\n    const pastIndex = pastRankList.findIndex((item) => item.term === term);\r\n    if (pastIndex === -1) return \"new\";\r\n    if (pastIndex < index) return \"↑\";\r\n    if (pastIndex > index) return \"↓\";\r\n    return \"-\";\r\n};\n"}]}]],"frontmatter":{"label":"Web","title":"검색기능의 다양화 I - 실시간 검색어 순위 (Redis)","subTitle":"Redis zincrby와 zrevrange의 활용","date":"2025.02.01","mins":10,"tags":["Redis","zincrby","zrevrange","검색어 순위"],"imageUrl":null}}]
8:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"검색기능의 다양화 I - 실시간 검색어 순위 (Redis)"}],["$","meta","3",{"name":"description","content":"Redis zincrby와 zrevrange의 활용"}],["$","link","4",{"rel":"canonical","href":"https://weaall.github.io/"}],["$","meta","5",{"property":"og:title","content":"Weaall's Dive"}],["$","meta","6",{"property":"og:description","content":"Weaall's pretty personal idea"}],["$","meta","7",{"property":"og:url","content":"https://weaall.github.io/"}],["$","meta","8",{"property":"og:site_name","content":"Weaall's Dive"}],["$","meta","9",{"property":"og:image","content":"https://weaall.github.io/profile.png"}],["$","meta","10",{"property":"og:image:alt","content":"Weaall's Dive"}],["$","meta","11",{"property":"og:type","content":"website"}],["$","meta","12",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","13",{"name":"twitter:title","content":"Weaall's Dive"}],["$","meta","14",{"name":"twitter:description","content":"Weaall's pretty personal idea"}],["$","meta","15",{"name":"twitter:image","content":"https://weaall.github.io/profile.png"}],["$","meta","16",{"name":"twitter:image:alt","content":"Weaall's Dive"}],["$","link","17",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}]]
1:null
