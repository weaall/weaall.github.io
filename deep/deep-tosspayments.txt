3:I[5613,[],""]
5:I[1778,[],""]
6:I[7709,["229","static/chunks/229-547ffddabf4aab4b.js","250","static/chunks/250-e3db70cd67721be2.js","185","static/chunks/app/layout-7f1e3a5373a89a95.js"],""]
7:I[8667,["160","static/chunks/app/not-found-28d903cad857ed6b.js"],""]
4:["slug","deep-tosspayments","d"]
0:["w41UdMrvJWXhG3BRi0NFd",[[["",{"children":["(pages)",{"children":["deep",{"children":[["slug","deep-tosspayments","d"],{"children":["__PAGE__?{\"slug\":\"deep-tosspayments\"}",{}]}]}]}]},"$undefined","$undefined",true],["",{"children":["(pages)",{"children":["deep",{"children":[["slug","deep-tosspayments","d"],{"children":["__PAGE__",{},["$L1","$L2",null]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","(pages)","children","deep","children","$4","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/7f6bd37aab40623f.css","precedence":"next","crossOrigin":""}]]}]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","(pages)","children","deep","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","(pages)","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]},[null,["$","html",null,{"lang":"kr","children":[["$","head",null,{"children":[["$","meta",null,{"name":"naver-site-verification","content":"e782934088f4524e1d46947402328d9864f04318"}],["$","meta",null,{"name":"google-site-verification","content":"EB5qLPhkvA7mD6Yz6VpiZaMErWP4KIB7Aj_rR-xqdsA"}]]}],["$","body",null,{"className":"__className_a1b02f","children":["$","div",null,{"children":[["$","div",null,{"children":[["$","$L6",null,{}],["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","$L7",null,{}],"notFoundStyles":[],"styles":null}]],"style":{},"className":"mx-auto max-w-[1080px] h-auto px-1"}],["$","div",null,{"children":["$","div",null,{"children":[["$","div",null,{"children":[["$","p",null,{"children":"Dong-Hyun Wi","style":{},"className":"font-bold text-2xl"}],["$","p",null,{"children":"weaall@naver.com","style":{},"className":"text-sm"}],["$","p",null,{"children":"weaall88@gmail.com","style":{},"className":"text-sm"}]],"style":{},"className":"flex flex-col m-auto text-center space-y-1 w-[33%]"}],["$","div",null,{"children":["$","img",null,{"alt":"","src":"../../assets/svg/user_icon.svg","style":{},"className":"w-8 h-full m-auto group-hover:scale-110"}],"style":{},"className":"flex flex-col m-auto text-center space-y-1 w-[33%]"}],["$","div",null,{"children":[["$","a",null,{"href":"/","children":"Main","style":{},"className":"font-bold text-base"}],["$","a",null,{"href":"/shallow","children":"Shallow","style":{},"className":"font-bold text-base"}],["$","a",null,{"href":"/deep","children":"Deep","style":{},"className":"font-bold text-base"}],["$","a",null,{"href":"/","children":"Me","style":{},"className":"font-bold text-base"}]],"style":{},"className":"flex m-auto space-x-4 w-[33%] justify-center"}]],"style":{},"className":"mx-auto max-w-[1080px] h-40 justify-between flex mobile:flex-col mobile:h-52"}],"style":{},"className":"w-full border-t mt-20 text-t-main"}]],"style":{},"className":"mx-auto text-main max-w-[1080px]"}]}]]}],null]],[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/6a5f3c35560f6327.css","precedence":"next","crossOrigin":""}],["$","link","1",{"rel":"stylesheet","href":"/_next/static/css/bc0b5054220f7bba.css","precedence":"next","crossOrigin":""}]],"$L8"]]]]
9:I[9275,["229","static/chunks/229-547ffddabf4aab4b.js","606","static/chunks/app/(pages)/deep/%5Bslug%5D/page-6d55cf1399f8cc06.js"],"MDXContent"]
2:["$","$L9",null,{"content":[["$","h2",null,{"children":["$","a",null,{"href":"#TossPayments","children":"TossPayments"}],"style":{},"className":"text-xl font-bold mt-0 mb-9 after:content-['.'] after:text-red-500 cursor-pointer"}],"\n",["$","p",null,{"children":[["$","a",null,{"target":"_blank","href":"https://namu.wiki/w/%EA%B2%B0%EC%A0%9C%EB%8C%80%ED%96%89%EC%82%AC","children":"전자결제대행사","style":{},"className":"text-base font-bold text-red-500"}],"\r\n(PG / Payment Gateway)는 이커머스 결제 지불 대행 서비스를 진행하는 중개업체를 이르는 말인데,",["$","br",null,{}],"\n",["$","strong",null,{"children":"토스페이먼츠, KG이니시스, NHN KCP","style":{},"className":"font-bold"}]," 이 3개 업체가 가장 높은 점유율을 차지한다."],"style":{},"className":"text-base py-3"}],"\n",["$","p",null,{"children":"나는 가장 점유율이 높고, 개발자센터를 통해 쉽고 간편하게 연동할 수 있는 토스페이먼츠를 사용해보기로 했다.","style":{},"className":"text-base py-3"}],"\n",["$","hr",null,{"children":"$undefined","style":{},"className":"my-20 w-full h-[2px] bg-t-main"}],"\n",["$","h2",null,{"children":["$","a",null,{"href":"#결제 프로세스와 검증","children":"결제 프로세스와 검증"}],"style":{},"className":"text-xl font-bold mt-0 mb-9 after:content-['.'] after:text-red-500 cursor-pointer"}],"\n",["$","p",null,{"children":[["$","div",null,{"children":[["$","img",null,{"src":"/posts/deep/tossPayments/toss_payments.png","children":"$undefined","style":{},"className":"mx-auto"}],["$","p",null,{"children":"토스페이먼츠 결제 과정","style":{},"className":"text-xs text-gray-400"}]],"style":{},"className":"w-full mx-auto py-6 text-center"}],"\r\n토스페이먼츠(*이하토스)의 결제 과정은 다음과같다."],"style":{},"className":"text-base py-3"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"토스페이먼츠에서 제공하는 결제위젯을 화면에 전시","style":{},"className":"pl-6 py-2 text-base before:content-['-'] before:font-bold before:pr-3"}],"\n",["$","li",null,{"children":"결제하기로 요청","style":{},"className":"pl-6 py-2 text-base before:content-['-'] before:font-bold before:pr-3"}],"\n",["$","li",null,{"children":"사용자 결제","style":{},"className":"pl-6 py-2 text-base before:content-['-'] before:font-bold before:pr-3"}],"\n",["$","li",null,{"children":"결제승인 API요청","style":{},"className":"pl-6 py-2 text-base before:content-['-'] before:font-bold before:pr-3"}],"\n",["$","li",null,{"children":"성공, 실패 Url로 리다이렉트","style":{},"className":"pl-6 py-2 text-base before:content-['-'] before:font-bold before:pr-3"}],"\n"]}],"\n",["$","p",null,{"children":"이 일련의 과정속에서 가장 중요한건 MITM을 막고 데이터의 무결성을 훼손하지 않는일일 것이다.","style":{},"className":"text-base py-3"}],"\n",["$","hr",null,{"children":"$undefined","style":{},"className":"my-20 w-full h-[2px] bg-t-main"}],"\n",["$","h2",null,{"children":["$","a",null,{"href":"#접근 방법","children":"접근 방법"}],"style":{},"className":"text-xl font-bold mt-0 mb-9 after:content-['.'] after:text-red-500 cursor-pointer"}],"\n",["$","h3",null,{"children":"1","style":{},"className":"text-lg font-bold mt-9 mb-6"}],"\n",["$","p",null,{"children":"1번에서 백엔드로 결제ID와 금액, 몇가지 구매정보를 보내 DB와 비교후 저장한다. 이를 통해 1차 가격변조를 막고 주문가능 상태를 한번 더 확인한다.","style":{},"className":"text-base py-3"}],"\n",["$","p",null,{"children":"[토스페이먼츠에서 제공하는 결제창 진입 직전에 백엔드와의 통신이 일어나지만, JWT만 있다면 포스트맨으로도 접근이 가능하다.]","style":{},"className":"text-base py-3"}],"\n",["$","p",null,{"children":"[결제ID를 현재시간 + 금액등을 조합해 Hash하여 백엔드로 보내 다시 검증한다면 포스트맨 등의 엔드포인트 접근을 막을 수 있을 것 같다.]","style":{},"className":"text-base py-3"}],"\n",["$","h3",null,{"children":"2-1","style":{},"className":"text-lg font-bold mt-9 mb-6"}],"\n",["$","p",null,{"children":"1번에서 추가로 결제창 진입과 동시에 기존의 상품 갯수를 줄여놓고 페이지이탈(새로고침, 브라우저 닫기, 결제창 닫기 등)시\r\nbeforeunload과 sendBeacon을 통해 상품의 갯수를 롤백 하는 방식을 택하려 했으나, 브라우저 호환성이나 결제가 완료되고 리다이렉트 되는 경우에도 롤백하는 경우가 생긴다.","style":{},"className":"text-base py-3"}],"\n",["$","p",null,{"children":"[롤백이 될때 추가로 백엔드와 통신하게 되는데 만약 포스트맨으로 이 롤백을 실행한다면, 상품갯수를 줄이고 주문을 추가로 넣을 수 있다.]","style":{},"className":"text-base py-3"}],"\n",["$","p",null,{"children":"[1번과 동일하게 Hash하여 백엔드로 보내 1번에서 저장한 데이터와 비교한다고해도 DB원본에 대한 접근횟수가 너무 많아진다.]","style":{},"className":"text-base py-3"}],"\n",["$","h3",null,{"children":"2-2","style":{},"className":"text-lg font-bold mt-9 mb-6"}],"\n",["$","p",null,{"children":"2-1과 같은 문제를 해결하기 위해 롤백을 실행하는 일을 백엔드 자체에 맡길 수 있다. 1번에서 저장한 데이터에 status를 추가하여,\r\n결제가 완료를 판단 백엔드에서 1분간격으로 롤백을 진행하여 DB에 반영한다.","style":{},"className":"text-base py-3"}],"\n",["$","p",null,{"children":"[실시간성은 하락하고 백엔드의 부하는 늘어난다. 또 사실상 DB접근 빈도가 2-1보다 많을 가능성도 있다.]","style":{},"className":"text-base py-3"}],"\n",["$","h3",null,{"children":"2-3","style":{},"className":"text-lg font-bold mt-9 mb-6"}],"\n",["$","p",null,{"children":"가장 좋은 방법은 백엔드에게 결제를 맡기는 일이다. successUrl을 직접 백엔드 엔드포인트로 연결,\r\n구매정보비교 -> 주문가능 상태 확인 -> 상품 갯수 줄이기 -> 결제 -> 성공 / 실패시 롤백의 순으로 진행하면 된다.\r\nDB접근 횟수도 줄어들고, 실시간성도 보장된다.","style":{},"className":"text-base py-3"}],"\n",["$","hr",null,{"children":"$undefined","style":{},"className":"my-20 w-full h-[2px] bg-t-main"}],"\n",["$","h2",null,{"children":["$","a",null,{"href":"#최종 설계 모델","children":"최종 설계 모델"}],"style":{},"className":"text-xl font-bold mt-0 mb-9 after:content-['.'] after:text-red-500 cursor-pointer"}],"\n",["$","p",null,{"children":["$","div",null,{"children":[["$","img",null,{"src":"/posts/deep/tossPayments/toss_payments_arch.png","children":"$undefined","style":{},"className":"mx-auto"}],["$","p",null,{"children":"토스페이먼츠 설계","style":{},"className":"text-xs text-gray-400"}]],"style":{},"className":"w-full mx-auto py-6 text-center"}],"style":{},"className":"text-base py-3"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"2-3은 successUrl을 받고 결제 승인 API를 보내기 전에 서버에서 처리된다.","style":{},"className":"pl-6 py-2 text-base before:content-['-'] before:font-bold before:pr-3"}],"\n"]}]],"frontmatter":{"label":"Database","title":"TossPayments의 대한 깊은 고찰","subTitle":"결제는 몇번의 검증이 들어가야 좋을까?","date":"2024.06.06","mins":20,"tags":["Toss","TossPayments","결제연동","PG사","보안"],"imageUrl":null}}]
8:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"TossPayments의 대한 깊은 고찰"}],["$","meta","3",{"name":"description","content":"결제는 몇번의 검증이 들어가야 좋을까?"}],["$","link","4",{"rel":"canonical","href":"https://weaall.github.io/"}],["$","meta","5",{"property":"og:title","content":"Weaall's Dive"}],["$","meta","6",{"property":"og:description","content":"Weaall's pretty personal idea"}],["$","meta","7",{"property":"og:url","content":"https://weaall.github.io/"}],["$","meta","8",{"property":"og:site_name","content":"Weaall's Dive"}],["$","meta","9",{"property":"og:image","content":"https://weaall.github.io/profile.png"}],["$","meta","10",{"property":"og:image:alt","content":"Weaall's Dive"}],["$","meta","11",{"property":"og:type","content":"website"}],["$","meta","12",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","13",{"name":"twitter:title","content":"Weaall's Dive"}],["$","meta","14",{"name":"twitter:description","content":"Weaall's pretty personal idea"}],["$","meta","15",{"name":"twitter:image","content":"https://weaall.github.io/profile.png"}],["$","meta","16",{"name":"twitter:image:alt","content":"Weaall's Dive"}]]
1:null
